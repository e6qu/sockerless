# E2E-026: Validate full E2E suite

**Status:** DONE
**Phase:** 19 — Meaningful E2E Tests

Validated the full E2E suite across all 7 backends. Fixed multiple issues discovered during validation:

1. **FaaS invoke race condition** — Added `Prepare`/`WaitForDisconnect` to `AgentRegistry` so invoke goroutines wait for agent disconnection before stopping containers
2. **Archive operations for reverse agent** — Modified `handlePutArchive`/`handleHeadArchive`/`handleGetArchive` in core to write to host filesystem when container uses reverse agent (`AgentAddress == "reverse"`)
3. **Env/workdir passthrough** — Fixed `handleExecStart` to pass container+exec env vars and working directory through to `BridgeExec` for reverse agent exec
4. **FaaS variant routing** — Updated `get_test_variant()` in `lib.sh` to route services→services-wasm, custom-image→custom-image-wasm, container-action→container-action-faas for FaaS backends
5. **Shell compatibility** — Replaced `echo -e` with `printf '%b\n'` in custom-image-wasm YAMLs for dash compatibility

6. **WASM sandbox unknown command handling** — Added `IsKnownCommand()` check in `NewProcess()` that returns error for unknown commands (e.g. `gitlab-runner-helper`), letting core fall back to synthetic behavior
7. **GitLab memory backend synthetic mode** — Added `SOCKERLESS_SYNTHETIC=1` env var support to memory backend to disable WASM for GitLab runner tests (gitlab-runner requires helper binaries incompatible with WASM)
8. **YAML colon-space fix** — Fixed `cut -d: -f2` → `cut -d':' -f2` in GitLab `custom-image-wasm.yml` (plain scalars cannot contain `: `)

**Results:**
- GitHub Actions: 84 PASS, 0 FAIL (12 workflows × 7 backends)
- GitLab Runner: 12 PASS, 0 FAIL (memory backend, synthetic mode)
- Simulator-backend integration: 107 PASS, 0 FAIL
- Lint: all 13 modules clean
