# P32-004: Add IsSynthetic to ProcessLifecycleDriver

**Phase:** 32A (Driver Interface Extension)
**Depends on:** —
**Estimated effort:** S

---

## Description

Add `IsSynthetic() bool` to `ProcessLifecycleDriver` to replace the two remaining `s.ProcessFactory == nil` checks in handler code.

## What to Change

### 1. Extend `ProcessLifecycleDriver` interface in `backends/core/drivers.go`

Add:
```go
// IsSynthetic returns true if this driver provides no real process execution.
// Used by handlers that need to adapt behavior for synthetic mode
// (e.g., auto-stop scheduling, volume directory creation).
IsSynthetic() bool
```

### 2. Implement in both tiers

**WASMProcessLifecycleDriver** (`drivers_process.go`):
```go
func (d *WASMProcessLifecycleDriver) IsSynthetic() bool {
    return false
}
```

**SyntheticProcessLifecycleDriver** (`drivers_synthetic.go`):
```go
func (d *SyntheticProcessLifecycleDriver) IsSynthetic() bool {
    return true
}
```

### 3. Update handler code

**handle_exec.go line 183** — replace `s.ProcessFactory == nil`:
```go
// BEFORE:
if c.AgentAddress == "" && s.ProcessFactory == nil {
    go s.scheduleExecAutoStop(exec.ContainerID)
}

// AFTER:
if c.AgentAddress == "" && s.Drivers.ProcessLifecycle.IsSynthetic() {
    go s.scheduleExecAutoStop(exec.ContainerID)
}
```

**handle_volumes.go line 53** — replace `s.ProcessFactory != nil`:
```go
// BEFORE:
if s.ProcessFactory != nil {
    dir, err := os.MkdirTemp("", "vol-"+name+"-*")
    ...
}

// AFTER:
if !s.Drivers.ProcessLifecycle.IsSynthetic() {
    dir, err := os.MkdirTemp("", "vol-"+name+"-*")
    ...
}
```

## Acceptance Criteria

1. `ProcessLifecycleDriver` interface has `IsSynthetic() bool`
2. Both tiers implement the method
3. `handle_exec.go` and `handle_volumes.go` no longer reference `s.ProcessFactory`
4. All tests pass: `make test`, `make lint`

## After Completing

Update `_tasks/done/P32-004.md` with actual changes. Update `STATUS.md` progress line.
