# P66-004: bleephub Middleware + Workflow Spans

**Status:** Done
**Phase:** 66 â€” OpenTelemetry Tracing

## What
Added `otelhttp.NewHandler` middleware to bleephub server.go. Added `ctx context.Context` + OTel spans to 4 workflow functions: submitWorkflow, dispatchReadyJobs, dispatchWorkflowJob, onJobCompleted. Each span includes relevant attributes (workflow.name, workflow.id, job.key, job.id, job.result).

Updated production callers in jobs.go, run_service.go, webhooks.go. Updated ~67 test call sites across workflows_test.go, workflows_complex_test.go, concurrency_test.go with `context.Background()`.

## Tests
298 bleephub tests PASS (293 prior + 5 new OTel tests).
