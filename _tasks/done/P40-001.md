# P40-001: bleephub Pull Requests

**Phase:** 40
**Status:** Complete
**Date:** 2026-02-22

## Summary

Added full pull request lifecycle to bleephub with REST and GraphQL APIs.

## Files Created
- `bleephub/store_pulls.go` (~170 lines) — PullRequest + PullRequestReview types + 7 CRUD methods
- `bleephub/gh_pulls_rest.go` (~380 lines) — 8 REST handlers + JSON converters
- `bleephub/gh_pulls_graphql.go` (~570 lines) — GraphQL types, enums, queries, mutations
- `bleephub/gh_pulls_test.go` (~530 lines) — 28 unit tests (14 REST + 14 GraphQL)

## Files Modified
- `bleephub/store.go` — Added PullRequests/PRReviews maps + counters
- `bleephub/gh_graphql.go` — Wire addPullRequestFieldsToSchema()
- `bleephub/gh_issues_graphql.go` — Return issueType from addIssueFieldsToSchema
- `bleephub/server.go` — Register pull routes

## Features
- PR CRUD (create, list, get, update, close, reopen)
- Merge via REST (PUT /merge) and GraphQL (mergePullRequest mutation)
- Shared issue/PR numbering via repo.NextIssueNumber
- PR reviews with state (APPROVED, CHANGES_REQUESTED, COMMENTED)
- Review decision derivation
- Draft PR support
- Label/assignee/milestone associations on PRs
- State filtering (OPEN, CLOSED, MERGED)
- Head/base ref filtering
- StatusCheckRollup stub
- Relay cursor pagination on PR connections

## Test Results
- 107 unit tests pass (79 existing + 28 new)
- go vet clean
