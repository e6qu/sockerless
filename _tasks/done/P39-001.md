# P39-001: bleephub Issues + Labels + Milestones

**Phase**: 39
**Status**: Complete
**Date**: 2026-02-22

## Summary

Added full issue tracking to bleephub with per-repo sequential numbering, label/milestone management, comments, and reactions. Both REST and GraphQL APIs implemented — `gh issue create/list/view/close` uses GraphQL exclusively, while labels and milestones use REST.

## Files Created (5)
- `bleephub/store_issues.go` (~300 lines) — IssueLabel, Milestone, Issue, Comment types + 18 CRUD methods
- `bleephub/gh_labels_rest.go` (~290 lines) — REST: label + milestone CRUD, route registration
- `bleephub/gh_issues_rest.go` (~540 lines) — REST: issue + comment endpoints, issue-label management
- `bleephub/gh_issues_graphql.go` (~650 lines) — GraphQL: Issue types, 5 mutations, repository queries, pagination, static reactions
- `bleephub/gh_issues_test.go` (~580 lines) — 28 unit tests covering REST + GraphQL

## Files Modified (5)
- `bleephub/store.go` — Added Issues/Labels/Milestones/Comments maps + counters to Store
- `bleephub/store_repos.go` — Added NextIssueNumber, NextMilestoneNumber to Repo struct
- `bleephub/store_orgs.go` — Initialize issue/milestone counters in CreateOrgRepo
- `bleephub/gh_repos_graphql.go` — Changed return type to (repoType, mutationType) tuple
- `bleephub/gh_graphql.go` — Wired issue schema via addIssueFieldsToSchema

## Bugs Found & Fixed
1. GraphQL enum types needed for `gh` CLI — `states:[OPEN]` sent as enum, not string
2. Deadlock in issueToJSON — RLock + ListComments() both take RLock
3. Deadlock in handleAddIssueLabels — UpdateIssue write lock + GetLabelByName read lock

## Test Results
- 79 unit tests PASS (51 existing + 28 new)
- go vet clean
- 0 regressions
