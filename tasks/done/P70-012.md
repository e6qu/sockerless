# P70-012: GCP — Smoke Test (Cloud Run + Cloud Functions Against Simulator)

**Component:** SIM (simulators/gcp)
**Phase:** 70 — Milestone 2 (GCP Fidelity)
**Depends on:** P70-007, P70-008, P70-009, P70-010, P70-011
**Estimated effort:** L

---

## Description

End-to-end integration test that starts the GCP simulator, exercises the
Cloud Run backend's flow (create job → run → get logs → cancel → delete),
and the Cloud Functions flow (create → invoke → get logs → delete). Validates
the full path: SDK calls → simulator → state → log injection → log query.

## Acceptance Criteria

1. Test starts GCP simulator on a free port
2. Cloud Run flow: CreateJob → RunJob → GetExecution (verify RunningCount) →
   list log entries (verify entries with resource.type=cloud_run_job) →
   CancelExecution → GetExecution (verify CancelledCount) → DeleteJob
3. Cloud Functions flow: CreateFunction → verify ServiceConfig.Uri →
   Invoke function → list log entries (verify entries with
   resource.type=cloud_run_revision) → DeleteFunction
4. All assertions pass
5. Test is self-contained

## Definition of Done

- [ ] `go build ./...` passes
- [ ] All existing tests pass
- [ ] New integration test passes
- [ ] PR created via `gh pr create`, CI passes, merged via `gh pr merge`

## Suggested File Paths

- `simulators/gcp/sdk-tests/integration_test.go` — new file
