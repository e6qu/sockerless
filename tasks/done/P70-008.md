# P70-008: GCP — Cloud Run Log Entry Injection

**Component:** SIM (simulators/gcp)
**Phase:** 70 — Milestone 2 (GCP Fidelity)
**Depends on:** P70-007
**Estimated effort:** M

---

## Description

The Cloud Run Jobs handler (`cloudrunjobs.go`) must auto-write log entries to
the Cloud Logging store when executions run. Currently, no log entries are
created — the `entries:write` endpoint exists but nothing calls it internally.

Without this, the Cloud Run backend's log streaming always returns empty.

## Context

- `simulators/gcp/cloudrunjobs.go`: creates executions but writes no logs
- `simulators/gcp/logging.go`: has `entries:write` handler and `logEntries` store
- Backend `backends/cloudrun/logs.go:103`: queries with filter
  `resource.type="cloud_run_job" AND resource.labels.job_name="{name}"`
- AWS simulator already does this for ECS: `simulators/aws/ecs.go:582`

## Acceptance Criteria

1. When RunJob creates an execution, at least one log entry is written to
   the logging store
2. Entry has `resource.type = "cloud_run_job"`
3. Entry has `resource.labels.job_name = "{jobName}"` (short name, not full path)
4. Entry has `textPayload` with meaningful content (e.g., "Container started"
   or the container command)
5. Entry has a valid `timestamp`
6. When execution completes (auto-stop or agent finish), another entry is
   written (e.g., "Execution completed")
7. Entries are retrievable via `entries:list` with the structured filter
8. Existing tests pass unchanged
9. New test verifies: RunJob → list entries with filter → entries found

## Definition of Done

- [ ] `go build ./...` passes
- [ ] All existing tests pass
- [ ] New test passes
- [ ] PR created via `gh pr create`, CI passes, merged via `gh pr merge`

## Suggested File Paths

- `simulators/gcp/cloudrunjobs.go` — inject log entries on execution create/complete
- `simulators/gcp/logging.go` — may need to export `logEntries` store or
  provide a helper function for internal injection
- `simulators/gcp/sdk-tests/run_test.go` — extend with log verification

## Notes

- The logging store key is the `logName` — use format like
  `projects/{project}/logs/run.googleapis.com%2Fstdout`
- Keep injection minimal (2-3 entries per execution lifecycle)
