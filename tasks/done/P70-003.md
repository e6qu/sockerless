# P70-003: AWS — DescribeTasks Nil ExitCode Handling

**Component:** SIM (simulators/aws)
**Phase:** 70 — Milestone 1 (AWS Fidelity)
**Depends on:** —
**Estimated effort:** S

---

## Description

Ensure `DescribeTasks` returns `ExitCode` as `nil` (*int32) for containers in
running tasks and only sets it to a concrete value when the task reaches
STOPPED state. The ECS backend reads `Containers[].ExitCode` to determine
the container's exit status.

## Context

- ECS backend `containers.go:715` (`pollTaskExit`): reads `result.Tasks[0].Containers[].ExitCode`
- Real AWS: `ExitCode` is nil while RUNNING, set to 0/1/etc. when STOPPED
- Current simulator may return `ExitCode: 0` for all states

## Acceptance Criteria

1. `DescribeTasks` returns `ExitCode: nil` (field omitted from JSON) when task is PENDING or RUNNING
2. `DescribeTasks` returns `ExitCode: 0` (or actual exit code) when task is STOPPED
3. New SDK test: RunTask → DescribeTasks while RUNNING (verify nil) → StopTask → DescribeTasks (verify ExitCode set)

## Definition of Done

- [ ] `go build ./...` passes
- [ ] All existing SDK tests pass
- [ ] New SDK test passes
- [ ] PR created via `gh pr create`, CI passes, merged via `gh pr merge`

## Suggested File Paths

- `simulators/aws/ecs.go` — fix ExitCode in describeTasks handler
- `simulators/aws/sdk-tests/ecs_test.go` — add test

## Notes

- Use `*int32` (pointer) in the response struct so nil omits the field
- The auto-stop goroutine (3s timeout) should set ExitCode when transitioning to STOPPED
