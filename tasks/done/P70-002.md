# P70-002: AWS — CloudWatch GetLogEvents Pagination Tokens

**Component:** SIM (simulators/aws)
**Phase:** 70 — Milestone 1 (AWS Fidelity)
**Depends on:** —
**Estimated effort:** M

---

## Description

Replace the static `"f/0"` pagination token in `cloudwatch.go:366` with a
proper offset-based or sequence-based token. Real AWS behavior: the
`nextForwardToken` changes when new events are available, and stays the same
when no new events have arrived since the last read. The backend's follow
mode (`backends/ecs/logs.go`) uses this to detect "no new data" and sleep.

Currently, the static token causes the backend to re-fetch all events on
every poll iteration, producing duplicate log lines in follow mode.

## Context

- `cloudwatch.go:366`: `"nextForwardToken": "f/0"` (always static)
- ECS backend `logs.go:106,121`: compares `nextToken` to detect new events
- Real AWS: token encodes the position; same token = no new events
- Lambda backend also calls `GetLogEvents` with forward token

## Acceptance Criteria

1. `GetLogEvents` returns a `nextForwardToken` that encodes the current
   position (e.g., `"f/{eventCount}"` or `"f/{sequenceNumber}"`)
2. When called again with the same token and no new events have been added,
   the response returns the same token and an empty events array
3. When new events are added (via `PutLogEvents`) after the last read,
   the response returns only the new events and a new token
4. `nextBackwardToken` works similarly for reverse pagination
5. `StartFromHead=true` starts from the beginning; `false` from the end
6. Existing SDK tests pass unchanged
7. New SDK test verifies: write events → read with token → write more →
   read with same token → only new events returned

## Definition of Done

- [ ] `go build ./...` passes
- [ ] `go vet ./...` passes
- [ ] All existing SDK tests pass
- [ ] New SDK test for pagination behavior passes
- [ ] PR created via `gh pr create`, CI passes, merged via `gh pr merge`

## Suggested File Paths

- `simulators/aws/cloudwatch.go` — fix `handleCWGetLogEvents`
- `simulators/aws/sdk-tests/cloudwatch_test.go` — new/extended test

## Notes

- Token format suggestion: `"f/{offset}"` where offset is the index into the
  events array. Parse on incoming request, slice events from offset.
- The `Limit` parameter should apply after the offset
- Edge case: token for a stream that has been deleted → return empty
