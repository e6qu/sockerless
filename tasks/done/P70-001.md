# P70-001: AWS — Lambda Log Stream Auto-Creation

**Component:** SIM (simulators/aws)
**Phase:** 70 — Milestone 1 (AWS Fidelity)
**Depends on:** —
**Estimated effort:** M

---

## Description

When the AWS simulator's Lambda handler invokes a function, it must auto-create
a CloudWatch log group `/aws/lambda/{functionName}` and a log stream with the
format `YYYY/MM/DD/[$LATEST]{hex}`, then inject at least one log entry. This
mirrors how `ecs.go:582` already auto-creates log groups/streams for ECS tasks.

Without this, the Lambda backend's `logs.go:67` call to `DescribeLogStreams`
returns zero streams, and log output is silently lost.

## Context

- Lambda backend calls `DescribeLogStreams` with `LogGroupName=/aws/lambda/{fn}`,
  `OrderBy=LastEventTime`, `Descending=true`, `Limit=1` (see `backends/lambda/logs.go:67`)
- Then calls `GetLogEvents` on the returned stream name
- ECS simulator already does this: `simulators/aws/ecs.go:582` creates log
  group + stream + injects events when `awslogs` driver is configured
- Real AWS creates log groups/streams on first Lambda invocation automatically

## Acceptance Criteria

1. When `Invoke` is called on a Lambda function, the simulator creates
   log group `/aws/lambda/{functionName}` if it doesn't exist
2. A log stream is created with format `YYYY/MM/DD/[$LATEST]abcdef1234567890`
   (date + hex suffix)
3. At least one log entry is injected (e.g., "START RequestId: {uuid}")
4. `DescribeLogStreams` with `OrderBy=LastEventTime` and `Descending=true`
   returns the most recent stream first
5. `GetLogEvents` on the created stream returns the injected entries
6. Existing ECS log injection continues to work unchanged
7. New SDK test in `simulators/aws/sdk-tests/` verifies Lambda log creation

## Definition of Done

- [ ] `go build ./...` passes
- [ ] `go vet ./...` passes
- [ ] All existing SDK tests pass
- [ ] New SDK test passes
- [ ] PR created via `gh pr create`, CI passes, merged via `gh pr merge`

## Suggested File Paths

- `simulators/aws/lambda.go` — add log injection in invoke handler
- `simulators/aws/sdk-tests/lambda_test.go` — new test file

## Notes

- Keep the log injection function shared with ECS if possible (extract a helper)
- The hex suffix can be a random 16-char hex string
- DescribeLogStreams ordering by LastEventTime means the stream with the most
  recent PutLogEvents call should sort first
